{
  "id": "reubencpereira/yearly-air-quality-index-aqi-for-cdp-cities",
  "id_no": 939490,
  "datasetSlugNullable": "yearly-air-quality-index-aqi-for-cdp-cities",
  "ownerUserNullable": "reubencpereira",
  "usabilityRatingNullable": 0.7352941176470589,
  "titleNullable": "Yearly Air Quality Index (AQI) For CDP Cities",
  "subtitleNullable": "Yearly (2000-2019) PM2.5 AQI Averages for Cities Disclosing to CDP",
  "descriptionNullable": "### Dataset Description\nThis dataset contains yearly averages of PM2.5 \u00b5g/m3 measurements for all of the cities disclosing to the CDP.\n\n ### How was this dataset created?\n1. Yearly average averages of PM2.5 \u00b5g/m3 measurement for all weather stations was obtained from Historic Air Quality (https://www.epa.gov) data dataset hosted in Public Datasets hosted on Google Cloud BigQuery platform (https://cloud.google.com/public-datasets).\n\n**Query**\n\n```\nWITH BASE_DATA AS\n    (\n  SELECT\n    site_num,\n    year,\n    parameter_name,\n    arithmetic_mean,\n    arithmetic_standard_dev, ten_percentile, fifty_percentile, seventy_five_percentile, ninety_percentile, ninety_five_percentile,\n    units_of_measure,\n    ROW_NUMBER() OVER (PARTITION BY site_num, year, parameter_name, units_of_measure ORDER BY date_of_last_change DESC ) AS row_number\n\n  FROM\n    `bigquery-public-data.epa_historical_air_quality.air_quality_annual_summary` AS epa\n  )\n\nSELECT\n  * EXCEPT(row_number)\nFROM\n  BASE_DATA\nWHERE\n  row_number = 1\n#WHERE\n  #epa.units_of_measure = \"Micrograms/cubic meter (LC)\"\n  #AND epa.parameter_name = \"Acceptable PM2.5 AQI & Speciation Mass\"\n```\n\n2. For each city in the CDP dataset where location information was available, the measurements were obtained by cross-referencing with the closest weather station.\n\n**Query - Get nearest monitoring station to CDP City**\n\n```\nWITH\n  BASE_DATA AS (\n  SELECT\n    AS VALUE ARRAY_AGG(STRUCT&lt; site_num STRING, City_CDE STRING, account_number INT64, Dist FLOAT64&gt;( site_num ,\n        City_CDE,\n        account_number,\n        ST_DISTANCE( address_spatial ,\n          City_CDE_LOC))\n    ORDER BY\n      ST_DISTANCE( address_spatial ,\n        City_CDE_LOC)\n    LIMIT 1)[OFFSET(0)]\n  FROM (\n    SELECT\n      site_num ,\n      address_spatial\n    FROM\n      `stunning-object-277601.cdp_unlocking_climate_solutions_questions_analysis.air_quality_monitoring_sites`),\n    (\n    SELECT\n      organization AS City_CDE,\n      city_location AS City_CDE_LOC,\n      account_number\n    FROM\n      `stunning-object-277601.cdp_unlocking_climate_solutions.cities_disclosing_to_cdp_processed`)\n  WHERE\n    City_CDE_LOC IS NOT NULL\n    AND address_spatial IS NOT NULL\n  GROUP BY\n    account_number )\nSELECT\n  site_num, account_number, SAFE_DIVIDE(Dist, 1000) AS distance\nFROM\n  BASE_DATA\nORDER BY\n  distance DESC\n```\n\n**Query - Join to CDP City to station and get yearly measurements**\n\n```\nWITH BASE_DATA AS\n  (\n    SELECT\n      account_number,\n      organization, city, country,\n      year,\n      MAX(arithmetic_mean) AS arithmetic_mean,\n      MAX(ninety_five_percentile)AS ninety_five_percentile,\n\n    FROM\n      `stunning-object-277601.cdp_unlocking_climate_solutions_questions_analysis.nearest_monitoring_station_to_city`\n    JOIN\n      `stunning-object-277601.cdp_unlocking_climate_solutions_questions_analysis.yearly_air_quality_data` USING ( site_num )\n    JOIN\n      (SELECT DISTINCT CAST(account_number AS INT64) account_number, organization, city, country  FROM `stunning-object-277601.cdp_unlocking_climate_solutions.cities_disclosing_to_cdp_processed`) USING ( account_number )\n    WHERE\n      units_of_measure = \"Micrograms/cubic meter (LC)\"\n      AND parameter_name = \"Acceptable PM2.5 AQI & Speciation Mass\"\n    GROUP BY\n      account_number,\n      organization, city, country,\n      year\n    ORDER BY\n      organization\n  )\n\nSELECT\n  *\nFROM\n  BASE_DATA\nWHERE\n  year &gt;=2000\n```\n",
  "datasetId": 939490,
  "datasetSlug": "yearly-air-quality-index-aqi-for-cdp-cities",
  "hasDatasetSlug": true,
  "ownerUser": "reubencpereira",
  "hasOwnerUser": true,
  "usabilityRating": 0.7352941176470589,
  "hasUsabilityRating": true,
  "totalViews": 3284,
  "totalVotes": 6,
  "totalDownloads": 135,
  "title": "Yearly Air Quality Index (AQI) For CDP Cities",
  "hasTitle": true,
  "subtitle": "Yearly (2000-2019) PM2.5 AQI Averages for Cities Disclosing to CDP",
  "hasSubtitle": true,
  "description": "### Dataset Description\nThis dataset contains yearly averages of PM2.5 \u00b5g/m3 measurements for all of the cities disclosing to the CDP.\n\n ### How was this dataset created?\n1. Yearly average averages of PM2.5 \u00b5g/m3 measurement for all weather stations was obtained from Historic Air Quality (https://www.epa.gov) data dataset hosted in Public Datasets hosted on Google Cloud BigQuery platform (https://cloud.google.com/public-datasets).\n\n**Query**\n\n```\nWITH BASE_DATA AS\n    (\n  SELECT\n    site_num,\n    year,\n    parameter_name,\n    arithmetic_mean,\n    arithmetic_standard_dev, ten_percentile, fifty_percentile, seventy_five_percentile, ninety_percentile, ninety_five_percentile,\n    units_of_measure,\n    ROW_NUMBER() OVER (PARTITION BY site_num, year, parameter_name, units_of_measure ORDER BY date_of_last_change DESC ) AS row_number\n\n  FROM\n    `bigquery-public-data.epa_historical_air_quality.air_quality_annual_summary` AS epa\n  )\n\nSELECT\n  * EXCEPT(row_number)\nFROM\n  BASE_DATA\nWHERE\n  row_number = 1\n#WHERE\n  #epa.units_of_measure = \"Micrograms/cubic meter (LC)\"\n  #AND epa.parameter_name = \"Acceptable PM2.5 AQI & Speciation Mass\"\n```\n\n2. For each city in the CDP dataset where location information was available, the measurements were obtained by cross-referencing with the closest weather station.\n\n**Query - Get nearest monitoring station to CDP City**\n\n```\nWITH\n  BASE_DATA AS (\n  SELECT\n    AS VALUE ARRAY_AGG(STRUCT&lt; site_num STRING, City_CDE STRING, account_number INT64, Dist FLOAT64&gt;( site_num ,\n        City_CDE,\n        account_number,\n        ST_DISTANCE( address_spatial ,\n          City_CDE_LOC))\n    ORDER BY\n      ST_DISTANCE( address_spatial ,\n        City_CDE_LOC)\n    LIMIT 1)[OFFSET(0)]\n  FROM (\n    SELECT\n      site_num ,\n      address_spatial\n    FROM\n      `stunning-object-277601.cdp_unlocking_climate_solutions_questions_analysis.air_quality_monitoring_sites`),\n    (\n    SELECT\n      organization AS City_CDE,\n      city_location AS City_CDE_LOC,\n      account_number\n    FROM\n      `stunning-object-277601.cdp_unlocking_climate_solutions.cities_disclosing_to_cdp_processed`)\n  WHERE\n    City_CDE_LOC IS NOT NULL\n    AND address_spatial IS NOT NULL\n  GROUP BY\n    account_number )\nSELECT\n  site_num, account_number, SAFE_DIVIDE(Dist, 1000) AS distance\nFROM\n  BASE_DATA\nORDER BY\n  distance DESC\n```\n\n**Query - Join to CDP City to station and get yearly measurements**\n\n```\nWITH BASE_DATA AS\n  (\n    SELECT\n      account_number,\n      organization, city, country,\n      year,\n      MAX(arithmetic_mean) AS arithmetic_mean,\n      MAX(ninety_five_percentile)AS ninety_five_percentile,\n\n    FROM\n      `stunning-object-277601.cdp_unlocking_climate_solutions_questions_analysis.nearest_monitoring_station_to_city`\n    JOIN\n      `stunning-object-277601.cdp_unlocking_climate_solutions_questions_analysis.yearly_air_quality_data` USING ( site_num )\n    JOIN\n      (SELECT DISTINCT CAST(account_number AS INT64) account_number, organization, city, country  FROM `stunning-object-277601.cdp_unlocking_climate_solutions.cities_disclosing_to_cdp_processed`) USING ( account_number )\n    WHERE\n      units_of_measure = \"Micrograms/cubic meter (LC)\"\n      AND parameter_name = \"Acceptable PM2.5 AQI & Speciation Mass\"\n    GROUP BY\n      account_number,\n      organization, city, country,\n      year\n    ORDER BY\n      organization\n  )\n\nSELECT\n  *\nFROM\n  BASE_DATA\nWHERE\n  year &gt;=2000\n```\n",
  "hasDescription": true,
  "isPrivate": false,
  "keywords": [
    "earth and nature",
    "environment",
    "business",
    "time series analysis",
    "news"
  ],
  "licenses": [
    {
      "nameNullable": "unknown",
      "name": "unknown",
      "hasName": true
    }
  ],
  "collaborators": [],
  "data": []
}